<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width" />
<meta name="robots" content="noindex, nofollow" />
<title>üõ§Ô∏è Ajouter ou mettre √† jour un poste</title>
<style>
:root{
  --bg:#f2f2f7;
  --text:#1c1c1e;
  --subtle:#6b7280;
  --border:#d1d1d6;
  --primary:#007aff;
  --primary-hover:#0066d6;
  --success:#34c759;
  --danger:#ff3b30;
  --radius:14px;
}
body{
  margin:0;
  font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
  background:var(--bg);
  color:var(--text);
  padding:20px;
}
.wrap{
  max-width:640px;
  margin:auto;
  padding:0 8px;
}
h1{
  font-size:18px;
  font-weight:700;
  margin-bottom:6px;
  text-align:center;
  line-height:1.2;
}
.subtitle{
  text-align:center;
  font-size:13px;
  color:var(--subtle);
  margin-bottom:20px;
  line-height:1.2;
}

/* Segment control */
.segment{
  display:flex;
  background:#fff;
  border-radius:var(--radius);
  border:1px solid var(--border);
  overflow:hidden;
}
.segment input{display:none;}
.segment label{
  flex:1;
  padding:12px 0;
  text-align:center;
  font-weight:600;
  font-size:15px;
  cursor:pointer;
  transition:background .2s,color .2s;
}
.segment input:checked + label{
  background:var(--primary);
  color:#fff;
}

/* Form fields */
form{
  background:#fff;
  border-radius:var(--radius);
  border:1px solid var(--border);
  padding:16px;
  margin-top:16px;
}
.group{margin-top:14px;}
label.field{
  display:block;
  font-weight:600;
  margin-bottom:6px;
}
input[type="text"], textarea{
  width:100%;
  max-width:100%;
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:12px;
  font-size:16px;
  outline:none;
  box-sizing:border-box;
}
textarea{min-height:100px;resize:vertical;}
input:focus, textarea:focus{
  border-color:var(--primary);
  box-shadow:0 0 0 3px rgba(0,122,255,.2);
}
.hint{
  font-size:12px;
  color:var(--subtle);
  margin-top:4px;
}

/* Submit button */
.actions{margin-top:18px;}
button{
  width:100%;
  max-width:100%;
  padding:14px;
  font-size:16px;
  font-weight:700;
  color:#fff;
  background:var(--primary);
  border:none;
  border-radius:var(--radius);
  cursor:pointer;
  box-sizing:border-box;
}
button:hover{background:var(--primary-hover);}
button:disabled{opacity:.6;cursor:not-allowed;}

/* Toast message */
.toast{
  display:none;
  margin-top:12px;
  padding:12px;
  border-radius:var(--radius);
  font-weight:600;
  text-align:center;
}
.toast.show{display:block;}
.toast.error{background:rgba(255,59,48,.15);color:var(--danger);}

/* Overlay */
.overlay{
  position:fixed;
  top:0;left:0;right:0;bottom:0;
  background:rgba(0,0,0,0.4);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:1000;
  opacity:0;
  visibility:hidden;
  transition:opacity 0.3s ease, visibility 0.3s ease;
}
.overlay.show{
  opacity:1;
  visibility:visible;
}
.overlay-content{
  background:#fff;
  border-radius:var(--radius);
  padding:20px;
  max-width:320px;
  text-align:center;
  box-shadow:0 4px 10px rgba(0,0,0,0.3);
  transform:translateY(20px);
  transition:transform 0.3s ease;
}
.overlay.show .overlay-content{
  transform:translateY(0);
}
.overlay-content h2{
  font-size:18px;
  margin-bottom:10px;
  color:var(--success);
}
.overlay-buttons{
  display:flex;
  flex-direction:column;
  gap:10px;
  margin-top:15px;
}
.overlay-buttons button{
  padding:12px;
  border:none;
  border-radius:var(--radius);
  font-size:15px;
  cursor:pointer;
}
.btn-primary{
  background:var(--primary);
  color:#fff;
}
.btn-secondary{
  background:#e5e5ea;
  color:#000;
}

/* Dark mode */
@media (prefers-color-scheme: dark){
  :root{
    --bg:#1c1c1e;
    --text:#f5f5f7;
    --subtle:#a1a1aa;
    --border:#2c2c2e;
    --primary:#0a84ff;
    --primary-hover:#0060df;
    --success:#30d158;
    --danger:#ff453a;
  }
  body{ background:var(--bg); color:var(--text); }
  .segment{ background:#2c2c2e; border-color:var(--border); }
  .segment label{ color:var(--text); }
  form{ background:#2c2c2e; border-color:var(--border); }
  input[type="text"], textarea{
    background:#1c1c1e;
    color:var(--text);
    border-color:var(--border);
  }
  .hint{ color:var(--subtle); }
  .toast.error{ background:rgba(255,69,58,.15); }
  .btn-secondary{background:#3a3a3c;color:#fff;}
}
</style>
</head>
<body>
<div class="wrap">
  <h1>üõ§Ô∏è Ajouter ou mettre √† jour un poste</h1>
  <div class="subtitle">Indiquez un nouveau poste ou mettez √† jour un existant</div>

  <!-- Segmented control -->
  <div class="segment">
    <input type="radio" name="type" id="opt-ajout" value="Ajout" checked>
    <label for="opt-ajout">Ajout</label>
    <input type="radio" name="type" id="opt-modif" value="Modification">
    <label for="opt-modif">Modification</label>
  </div>

  <form id="formulaire">
    <!-- Honeypot -->
    <input type="text" name="website" class="hidden" autocomplete="off" tabindex="-1">

    <!-- Demandeur -->
    <div class="group">
      <label class="field" for="demandeur">üë§ Votre nom</label>
      <input type="text" name="demandeur" id="demandeur" placeholder="Nom, pr√©nom">
    </div>

    <!-- Bloc Ajout -->
    <div id="tab-ajout">
      <div class="group">
        <label class="field" for="nom_poste">üìç Nom du poste</label>
        <input type="text" name="nom_poste" id="nom_poste" placeholder="Alleux SP">
      </div>
      <div class="group">
        <label class="field" for="coordonnees">üåç Coordonn√©es / lien</label>
        <input type="text" name="coordonnees" id="coordonnees" placeholder="50.123, 3.456 ou lien Google Maps">
      </div>
      <div class="group">
        <label class="field" for="autre">üìù Remarques</label>
        <textarea name="autre" id="autre" placeholder="Toute information utile, code portail, etc..."></textarea>
      </div>
    </div>

    <!-- Bloc Modification -->
    <div id="tab-modif" class="hidden">
      <div class="group">
        <label class="field" for="nom_modif">‚úèÔ∏è Poste √† modifier</label>
        <input type="text" name="nom_modif" id="nom_modif" placeholder="Hazebrouck SSPA">
      </div>
      <div class="group">
        <label class="field" for="raison">‚ùì Raison</label>
        <textarea name="raison" id="raison" placeholder="Erreur coordonn√©es, changement d'acc√®s..."></textarea>
      </div>
    </div>

    <div class="actions">
      <button type="submit" id="submitBtn">‚úÖ Envoyer</button>
    </div>
    <div id="toast" class="toast"></div>
  </form>

  <div class="version">Version 01.03_11</div>
</div>

<!-- Overlay -->
<div class="overlay" id="successOverlay">
  <div class="overlay-content">
    <h2>‚úÖ Contribution enregistr√©e</h2>
    <p>Votre contribution a bien √©t√© prise en compte.</p>
    <div class="overlay-buttons">
      <button class="btn-primary" onclick="window.location.href='index.html'">‚¨ÖÔ∏è Retour √† l'accueil</button>
      <button class="btn-secondary" id="newContribution">‚ûï Nouvelle contribution</button>
    </div>
  </div>
</div>

<script>
const rAjout = document.getElementById('opt-ajout');
const rModif = document.getElementById('opt-modif');
const tabAjout = document.getElementById('tab-ajout');
const tabModif = document.getElementById('tab-modif');
const form = document.getElementById('formulaire');
const toast = document.getElementById('toast');
const submitBtn = document.getElementById('submitBtn');
const overlay = document.getElementById('successOverlay');
const newContributionBtn = document.getElementById('newContribution');

function setMode(mode){
  form.querySelectorAll('[name]').forEach(el => el.removeAttribute('required'));
  if(mode === 'Ajout'){
    tabAjout.classList.remove('hidden');
    tabModif.classList.add('hidden');
    form.demandeur.required = true;
    form.nom_poste.required = true;
    form.coordonnees.required = true;
  }else{
    tabModif.classList.remove('hidden');
    tabAjout.classList.add('hidden');
    form.demandeur.required = true;
    form.nom_modif.required = true;
    form.raison.required = true;
  }
}

rAjout.addEventListener('change', ()=>setMode('Ajout'));
rModif.addEventListener('change', ()=>setMode('Modification'));
setMode('Ajout');

function showToast(msg, type){
  toast.textContent = msg;
  toast.className = 'toast show ' + type;
}

form.addEventListener('submit', async (e)=>{
  e.preventDefault();
  if(form.website.value) return;

  submitBtn.disabled = true;

  const fd = new FormData(form);
  fd.set('type', rAjout.checked ? 'Ajout' : 'Modification');

  try{
    const res = await fetch("https://script.google.com/macros/s/AKfycbzJLm3bHvgGKuMx9v2JyW_Mx-qWoiS9VlEDgJzkrIvMSwQaDX-fpLiZhjRM3WW9jwZh_Q/exec", {
      method:'POST', body:fd
    });
    const text = await res.text();
    if(text.trim().toUpperCase() === 'OK'){
      overlay.classList.add('show'); // On affiche l'overlay au lieu du toast
    }else{
      showToast('‚ùå Erreur lors de l‚Äôenvoi', 'error');
    }
  }catch{
    showToast('‚ùå Probl√®me de connexion', 'error');
  }
  submitBtn.disabled = false;
});

newContributionBtn.addEventListener('click', ()=>{
  overlay.classList.remove('show');
  form.reset();
  setMode('Ajout');
});
</script>
</body>
</html>
