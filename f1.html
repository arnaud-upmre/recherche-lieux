<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width" />
<meta name="robots" content="noindex, nofollow" />
<title>üó∫Ô∏è Formulaire de contribution √† la carte GPS</title>
<style>
:root{
  --bg:#f2f2f7;
  --text:#1c1c1e;
  --subtle:#6b7280;
  --border:#d1d1d6;
  --primary:#007aff;
  --primary-hover:#0066d6;
  --success:#34c759;
  --danger:#ff3b30;
  --radius:14px;
}
body{
  margin:0;
  font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
  background:var(--bg);
  color:var(--text);
  padding:20px;
}
.wrap {
  max-width: 640px;
  margin: auto;
  padding: 0 8px; /* √©vite que les champs collent aux bords */
}
h1{
  font-size:22px;
  font-weight:700;
  margin-bottom:6px;
  text-align:center;
}
.subtitle{
  text-align:center;
  font-size:14px;
  color:var(--subtle);
  margin-bottom:20px;
}

/* Segment control */
.segment{
  display:flex;
  background:#fff;
  border-radius:var(--radius);
  border:1px solid var(--border);
  overflow:hidden;
}
.segment input{display:none;}
.segment label{
  flex:1;
  padding:12px 0;
  text-align:center;
  font-weight:600;
  font-size:15px;
  cursor:pointer;
  transition:background .2s,color .2s;
}
.segment input:checked + label{
  background:var(--primary);
  color:#fff;
}

/* Form fields */
form{
  background:#fff;
  border-radius:var(--radius);
  border:1px solid var(--border);
  padding:16px;
  margin-top:16px;
}
.group{margin-top:14px;}
label.field{
  display:block;
  font-weight:600;
  margin-bottom:6px;
}
input[type="text"], textarea{
  width:100%;
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:12px;
  font-size:16px;
  outline:none;
}
textarea{min-height:100px;resize:vertical;}
input:focus, textarea:focus{
  border-color:var(--primary);
  box-shadow:0 0 0 3px rgba(0,122,255,.2);
}
.hint{
  font-size:12px;
  color:var(--subtle);
  margin-top:4px;
}

/* Submit button */
.actions{margin-top:18px;}
button{
  width:100%;
  padding:14px;
  font-size:16px;
  font-weight:700;
  color:#fff;
  background:var(--primary);
  border:none;
  border-radius:var(--radius);
  cursor:pointer;
}
button:hover{background:var(--primary-hover);}
button:disabled{opacity:.6;cursor:not-allowed;}

/* Toast message */
.toast{
  display:none;
  margin-top:12px;
  padding:12px;
  border-radius:var(--radius);
  font-weight:600;
  text-align:center;
}
.toast.show{display:block;}
.toast.success{background:rgba(52,199,89,.15);color:var(--success);}
.toast.error{background:rgba(255,59,48,.15);color:var(--danger);}

.hidden{display:none;}
.version{
  text-align:center;
  color:var(--subtle);
  font-size:12px;
  margin-top:16px;
}

/* ===== Dark Mode ===== */
@media (prefers-color-scheme: dark){
  :root{
    --bg:#1c1c1e;
    --text:#f5f5f7;
    --subtle:#a1a1aa;
    --border:#2c2c2e;
    --primary:#0a84ff;
    --primary-hover:#0060df;
    --success:#30d158;
    --danger:#ff453a;
  }
  body{ background:var(--bg); color:var(--text); }
  .segment{ background:#2c2c2e; border-color:var(--border); }
  .segment label{ color:var(--text); }
  form{ background:#2c2c2e; border-color:var(--border); }
  input[type="text"], textarea{
  width: 100%;
  max-width: 100%;
  box-sizing: border-box;
}
    background:#1c1c1e;
    color:var(--text);
    border-color:var(--border);
  }
  .hint{ color:var(--subtle); }
  .toast.success{ background:rgba(48,209,88,.15); }
  .toast.error{ background:rgba(255,69,58,.15); }
}
</style>
</head>
<body>
<div class="wrap">
  <h1>üó∫Ô∏è Contribution √† la carte GPS</h1>
  <div class="subtitle">Ajoutez un poste ou proposez une modification</div>

  <!-- Segmented control -->
  <div class="segment">
    <input type="radio" name="type" id="opt-ajout" value="Ajout" checked>
    <label for="opt-ajout">Ajout</label>
    <input type="radio" name="type" id="opt-modif" value="Modification">
    <label for="opt-modif">Modification</label>
  </div>

  <form id="formulaire">
    <!-- Honeypot -->
    <input type="text" name="website" class="hidden" autocomplete="off" tabindex="-1">

    <!-- Demandeur -->
    <div class="group">
      <label class="field" for="demandeur">Demandeur</label>
      <input type="text" name="demandeur" id="demandeur" required>
    </div>

    <!-- Bloc Ajout -->
    <div id="tab-ajout">
      <div class="group">
        <label class="field" for="nom_poste">Nom du poste</label>
        <input type="text" name="nom_poste" id="nom_poste">
      </div>
      <div class="group">
        <label class="field" for="coordonnees">Coordonn√©es ou lien GPS</label>
        <input type="text" name="coordonnees" id="coordonnees">
        <div class="hint">Ex : 50.123, 3.456 ou lien Google Maps</div>
      </div>
      <div class="group">
        <label class="field" for="autre">Autre remarque</label>
        <textarea name="autre" id="autre"></textarea>
      </div>
    </div>

    <!-- Bloc Modification -->
    <div id="tab-modif" class="hidden">
      <div class="group">
        <label class="field" for="nom_modif">Nom du poste √† modifier</label>
        <input type="text" name="nom_modif" id="nom_modif">
      </div>
      <div class="group">
        <label class="field" for="raison">Raison de la modification</label>
        <textarea name="raison" id="raison"></textarea>
      </div>
    </div>

    <div class="actions">
      <button type="submit" id="submitBtn">‚úÖ Envoyer</button>
    </div>
    <div id="toast" class="toast"></div>
  </form>

  <div class="version">Version 02.10</div>
</div>

<script>
const rAjout = document.getElementById('opt-ajout');
const rModif = document.getElementById('opt-modif');
const tabAjout = document.getElementById('tab-ajout');
const tabModif = document.getElementById('tab-modif');
const form = document.getElementById('formulaire');
const toast = document.getElementById('toast');
const submitBtn = document.getElementById('submitBtn');

function setMode(mode){
  if(mode === 'Ajout'){
    tabAjout.classList.remove('hidden');
    tabModif.classList.add('hidden');
  }else{
    tabModif.classList.remove('hidden');
    tabAjout.classList.add('hidden');
  }
}
rAjout.addEventListener('change', ()=>setMode('Ajout'));
rModif.addEventListener('change', ()=>setMode('Modification'));
setMode('Ajout');

function showToast(msg, type){
  toast.textContent = msg;
  toast.className = 'toast show ' + type;
}

form.addEventListener('submit', async (e)=>{
  e.preventDefault();
  if(form.website.value) return; // anti-spam

  submitBtn.disabled = true;
  showToast('‚è≥ Envoi en cours‚Ä¶', 'info');

  const fd = new FormData(form);
  fd.set('type', rAjout.checked ? 'Ajout' : 'Modification');

  try{
    const res = await fetch("https://script.google.com/macros/s/AKfycbzJLm3bHvgGKuMx9v2JyW_Mx-qWoiS9VlEDgJzkrIvMSwQaDX-fpLiZhjRM3WW9jwZh_Q/exec", {
      method:'POST', body:fd
    });
    const text = await res.text();
    if(text.trim().toUpperCase() === 'OK'){
      showToast('‚úÖ Votre demande a bien √©t√© envoy√©e', 'success');
      form.reset();
      setMode('Ajout');
    }else{
      showToast('‚ùå Erreur lors de l‚Äôenvoi', 'error');
    }
  }catch{
    showToast('‚ùå Probl√®me de connexion', 'error');
  }
  submitBtn.disabled = false;
});
</script>
</body>
</html>
